<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Dashboard - –î–æ–∫—É–º–µ–Ω—Ç–∏</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .confidence-high { color: green; font-weight: bold; }
        .confidence-low { color: orange; }
    </style>
</head>
<body class="container mt-5">

<div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-2">
    <h2>üìÇ –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∏–π –∞—Ä—Ö—ñ–≤ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤</h2>
    <form th:action="@{/logout}" method="post">
        <button class="btn btn-outline-danger btn-sm">–í–∏–π—Ç–∏</button>
    </form>
</div>

<div class="card mb-5 shadow-sm">
    <div class="card-body bg-light">
        <h5 class="card-title">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –Ω–æ–≤–∏–π –¥–æ–∫—É–º–µ–Ω—Ç</h5>
        <p class="text-muted small">–ü—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å—Å—è PDF, DOCX, TXT. –§–∞–π–ª –±—É–¥–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±—Ä–æ–±–ª–µ–Ω–∏–π AI.</p>

        <form id="uploadForm">
            <div class="input-group">
                <input type="file" class="form-control" id="fileInput" name="file" required>
                <button class="btn btn-primary" type="button" onclick="uploadFile()">
                    üöÄ –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ç–∞ –ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏
                </button>
            </div>
            <div id="statusMessage" class="mt-2 fw-bold"></div>
        </form>
    </div>
</div>

<h4>–û—Å—Ç–∞–Ω–Ω—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏</h4>
<table class="table table-hover mt-3">
    <thead class="table-dark">
    <tr>
        <th>ID</th>
        <th>–ù–∞–∑–≤–∞ —Ñ–∞–π–ª—É</th>
        <th>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è (AI)</th>
        <th>–í–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å</th>
        <th>–°—Ç–∞—Ç—É—Å</th>
        <th>–î–∞—Ç–∞</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="doc : ${documents}">
        <td th:text="${doc.id}">1</td>
        <td th:text="${doc.filename}">report.pdf</td>
        <td>
            <span class="badge bg-info text-dark" th:text="${doc.category} ?: '–ù–µ –≤–∏–∑–Ω–∞—á–µ–Ω–æ'">–ë—ñ–∑–Ω–µ—Å</span>
        </td>
        <td>
                    <span th:if="${doc.confidence != null}"
                          th:text="${#numbers.formatPercent(doc.confidence, 1, 1)}"
                          th:class="${doc.confidence > 0.8} ? 'confidence-high' : 'confidence-low'">
                        98.5%
                    </span>
        </td>
        <td th:text="${doc.status}">CLASSIFIED</td>
        <td th:text="${#temporals.format(doc.uploadDate, 'dd-MM-yyyy HH:mm')}">01-01-2025</td>
    </tr>

    <tr th:if="${documents.isEmpty()}">
        <td colspan="6" class="text-center text-muted">–î–æ–∫—É–º–µ–Ω—Ç—ñ–≤ –ø–æ–∫–∏ –Ω–µ–º–∞—î. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –ø–µ—Ä—à–∏–π!</td>
    </tr>
    </tbody>
</table>

<script>
    async function uploadFile() {
        const fileInput = document.getElementById('fileInput');
        const statusMsg = document.getElementById('statusMessage');

        if(fileInput.files.length === 0) {
            alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä—ñ—Ç—å —Ñ–∞–π–ª!");
            return;
        }

        const formData = new FormData();
        formData.append("file", fileInput.files[0]);

        statusMsg.innerText = "‚è≥ –û–±—Ä–æ–±–∫–∞ AI... –¶–µ –º–æ–∂–µ –∑–∞–π–Ω—è—Ç–∏ –∫—ñ–ª—å–∫–∞ —Å–µ–∫—É–Ω–¥...";
        statusMsg.className = "text-primary";

        // –ë–ª–æ–∫—É—î–º–æ –∫–Ω–æ–ø–∫—É
        document.querySelector('button').disabled = true;

        try {
            const response = await fetch('/api/documents/upload', {
                method: 'POST',
                body: formData
            });

            if (response.ok) {
                statusMsg.innerText = "‚úÖ –£—Å–ø—ñ—à–Ω–æ! –û–Ω–æ–≤–ª—é—î–º–æ —Ç–∞–±–ª–∏—Ü—é...";
                statusMsg.className = "text-success";
                setTimeout(() => location.reload(), 1000);
            } else {
                statusMsg.innerText = "‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.";
                statusMsg.className = "text-danger";
                document.querySelector('button').disabled = false;
            }
        } catch (error) {
            console.error(error);
            statusMsg.innerText = "‚ùå –ü–æ–º–∏–ª–∫–∞ –∑'—î–¥–Ω–∞–Ω–Ω—è.";
            statusMsg.className = "text-danger";
            document.querySelector('button').disabled = false;
        }
    }
</script>
</body>
</html>